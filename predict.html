<script>
const steps = document.querySelectorAll(".step");
let currentStep = 0;

// Show specific step
function showStep(step) {
  steps[currentStep].classList.remove("active");
  steps[step].classList.add("active");
  currentStep = step;

  // Hide result container whenever changing steps
  document.getElementById("result-container").style.display = "none";
}

// Button clicks
document.getElementById("nextBtn1").onclick = () => {
  if (validateStep(0)) showStep(1);
};
document.getElementById("nextBtn2").onclick = () => {
  if (validateStep(1)) showStep(2);
};
document.getElementById("prevBtn2").onclick = () => showStep(0);
document.getElementById("prevBtn3").onclick = () => showStep(1);

// Validate required fields in the current step
function validateStep(stepIndex) {
  const step = steps[stepIndex];
  const inputs = step.querySelectorAll("input, select");
  for (let input of inputs) {
    if (!input.value) {
      alert(`Please fill/select: "${input.previousElementSibling.innerText}"`);
      input.focus();
      return false;
    }
  }
  return true;
}

// Form submission
document.getElementById("mhForm").onsubmit = async (e) => {
  e.preventDefault();

  // Validate final step before sending
  if (!validateStep(currentStep)) return;

  const formData = new FormData(e.target);

  try {
    const response = await fetch("https://mental-health-treatment-prediction-in-zhbn.onrender.com/predict", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if (data.error) {
      document.getElementById("result").innerHTML =
        `<span style="color:red;">Error: ${data.error}</span>`;
    } else {
      document.getElementById("result").innerHTML =
        `Do you need mental health treatment?: <strong>${data.prediction}</strong>
         <br>Probability: <strong>${data.probability}</strong>`;
    }

    document.getElementById("result-container").style.display = "block";
  } catch (err) {
    document.getElementById("result").innerHTML =
      `<span style="color:red;">Request failed: ${err.message}</span>`;
    document.getElementById("result-container").style.display = "block";
  }
};
</script>
